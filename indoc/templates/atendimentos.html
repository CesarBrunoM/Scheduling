{% extends 'base.html' %}

{% block title %}
Novo atendimento
{% endblock %}

{% block page %}
  <h4>Atendimentos</h4>
{% endblock %}

{% block button %}                                
    <a href="{{ url_for('cadastro_atendimento') }}">
        <button type="button" class="btn btn-primary profile-button">Novo</button>
    </a>
    <div class="dropdown">
        <button class="btn btn-primary profile-button dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="bi bi-plus-square"></i> Filtros
        </button>
        <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="{{ url_for('cadastro_atendimento') }}">Data Cadastro</a></li>
            <li><a class="dropdown-item" href="{{ url_for('cadastrocliente') }}">Data Inicio</a></li>
            <li><a class="dropdown-item" href="{{ url_for('cadastrocliente') }}">Data Fechamento</a></li>
            <li><a class="dropdown-item" href="{{ url_for('cadastrocliente') }}">Data Cancelamento</a></li>
            <li><a class="dropdown-item" href="{{ url_for('usuario') }}">Atendente</a></li>
            <li><a class="dropdown-item" href="{{ url_for('usuario') }}">Cliente</a></li>
            <li><a class="dropdown-item" href="{{ url_for('cadastroproblema') }}">Problemas</a></li>
            <li><a class="dropdown-item" href="{{ url_for('cadastrosetor') }}">Setores</a></li>
            <li><a class="dropdown-item" href="{{ url_for('cadastrosetor') }}">Prioridade</a></li>
        </ul>
    </div> 
{% endblock %}

{% block body %}

<div class="conteiner mt-2 p-5">
    <h1>Atendimentos</h1>
    <hr>
    {% for atendimento in atendimentos.items %}
    <a class="link-dark" href="{{ url_for('visualizar_atendimento', atendimento_id=atendimento.id) }}"
                             style="text-decoration:none">
        <div class="row mt-4 p-2 bgcard">
            <div class="col col-2">
                <div class="card-body text-center">
                    <img src="{{ url_for('static', filename='logomarca_cliente/{}'.format(atendimento.cliente.logomarca)) }}"
                         alt="avatar"
                         class="rounded-circle img-fluid" style="width: 100px;">
                </div>
            </div>
            <div class="col col-10">
                <h4>Protocolo: #{{ atendimento.protocolo }} - {{ atendimento.cliente.nome }}</h4>
                {% if atendimento.status == "Aberto" %}
                    <b class="badge badge-pill bg-primary">{{ atendimento.status }}</b>
                {% elif atendimento.status == "Atendendo" %}
                    <b class="badge badge-pill bg-warning">{{ atendimento.status }}</b>
                {% elif atendimento.status == "Fechado" %}
                    <b class="badge badge-pill bg-success">{{ atendimento.status }}</b>
                {% elif atendimento.status == 'Cancelado' %}
                    <b class="badge badge-pill bg-danger">{{ atendimento.status }}</b>
                {% endif %}
                {% if atendimento.prioridade == "Baixo" %}
                <b class="badge badge-pill bg-primary">{{ atendimento.prioridade }}</b>
                {% elif atendimento.prioridade == "Normal" %}
                    <b class="badge badge-pill bg-info">{{ atendimento.prioridade }}</b>
                {% elif atendimento.prioridade == "Alta" %}
                    <b class="badge badge-pill bg-warning">{{ atendimento.prioridade }}</b>
                {% elif atendimento.prioridade == 'Urgente' %}
                    <b class="badge badge-pill bg-danger">{{ atendimento.prioridade }}</b>
                {% endif %}     
                <hr>
                <h6><b>Problema:</b> {{ atendimento.problema.descricao }} - <b>Data Abertura:</b> {{
                    datetime.strftime(atendimento.data_cadastro, '%d/%m/%Y às %H:%M') }}</h6>
                <b>Observação</b>
                <p>{{ atendimento.observacao }}</p>
            </div>
        </div>
    </a>
    {% endfor %}
    <hr>
    {% for page_num in atendimentos.iter_pages(left_edge=1, right_edge=1, left_current=1, right_current=2) %}
        {% if page_num %}            
            {% if atendimentos.page == page_num %}
                <a class="btn btn-secondary active mt-3" href="{{ url_for('atendimento', page=page_num ) }}">{{ page_num }}</a>
            {% else %}
                <a class="btn profile-button mt-3" href="{{ url_for('atendimento', page=page_num ) }}">{{ page_num }}</a>
            {% endif %} 
        {% else %}
            ...
        {% endif %}
    {% endfor %}
</div>

{% endblock %}